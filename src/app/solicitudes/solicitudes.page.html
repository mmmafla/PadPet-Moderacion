<ion-header>
  <ion-toolbar>
    <ion-title>Solicitudes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Filtros -->
  <ion-item>
    <ion-label>Estado</ion-label>
    <ion-select [(ngModel)]="filtroEstado" (ionChange)="aplicarFiltros()">
      <ion-select-option value="">Todos</ion-select-option>
      <ion-select-option value="pendiente">Pendiente</ion-select-option>
      <ion-select-option value="aceptada">Aceptada</ion-select-option>
      <ion-select-option value="rechazada">Rechazada</ion-select-option>
    </ion-select>
  </ion-item>

  <ion-searchbar
    placeholder="Buscar por RUN"
    [(ngModel)]="filtroRun"
    (ionInput)="aplicarFiltros()"
  ></ion-searchbar>

  <!-- Lista de solicitudes -->
  <ion-list *ngIf="solicitudesFiltradas.length > 0; else noSolicitudes">
    <ion-item *ngFor="let solicitud of solicitudesFiltradas">
      <ion-label>
        <h2><strong>RUN Veterinario:</strong> {{ solicitud.run_vet }}</h2>
        <p><strong>Fecha:</strong> {{ solicitud.fecha_envio | date:'medium' }}</p>
        <p><strong>Estado:</strong> {{ solicitud.estado }}</p>
        <p *ngIf="solicitud.comentario"><strong>Comentario:</strong> {{ solicitud.comentario }}</p>

        <div *ngIf="solicitud.estado === 'pendiente'" class="ion-margin-top">
          <ion-button color="success" (click)="aceptarSolicitud(solicitud.id_solicitud, solicitud.run_vet)">
            Aceptar
          </ion-button>
          <ion-button color="danger" (click)="rechazarSolicitud(solicitud.id_solicitud, solicitud.run_vet)">
            Rechazar
          </ion-button>
        </div>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- Mensaje si no hay resultados -->
  <ng-template #noSolicitudes>
    <ion-text color="medium">
      <p class="ion-text-center ion-margin-top">No hay solicitudes encontradas.</p>
    </ion-text>
  </ng-template>
</ion-content>
